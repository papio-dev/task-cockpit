## Визуальные состояния (в.с.) задачи:
- Idle — <пусто>: задача не запускалась / терминал переиспользован
- Running — '●': задача выполняется
- Running (N) — '●N': несколько инстансов выполняются. (Ограничение) Если инстансов более 9 отображается '●+'.
- Has terminal — '•': не выполняется, но терминал(ы) доступен

Визуальные состояния — это один бейдж на все. И ● имеет приоритет над •. Поэтому интерпретировать нужно так:
- '●' — задача выполняется, и, возможно, есть терминалы с прошлыми запусками задачи
- '•' — задача завершена. Результат ее работы доступен в терминале
- <пусто> — или не запускалась или терминал закрыт/переиспользован

Плюс пометки: 'background', 'default', 'hidden' для соответствующих задач.


## Known Limitations:

- Compound task не имеет собственного в.с. — отображает только состояния зависимостей. Моя реализация работает с процессами/терминалами и не умеет в "виртуальные сущности". Возможно подумать над реализацией и этого кейса.
- Exit code не различается — success и failure визуально одинаковы в списке задач. Во первых реализация этого не надежна (задача с `showReuseMessage=false` не сообщает свой код завершения, а много-инстансные задачи сообщают только о завершении первого инстанса). UI самой vscode достаточно. Реализована навигация к терминалу задачи — там и нужно смотреть код завершения, если он есть (`showReuseMessage=false`). Не баг - ограничение.
- Перезагрузка расширения сбрасывает все состояния (ограничение реализации. Не нужное усложнение).
- Несколько задач → один терминал (shared panel/group) — в.с. привязано к терминалу, не к задаче. Логика такая: Задача не запущена сейчас, а результат ее работы уже не доступен — у задачи нет "состояния" о котором можно сообщать.


## Чек-лист smoke-тестов

### Базовые

- [ ] Задача idle → 'Navigate to Terminal' не активен
- [ ] Запустить задачу → `●` →
  завершилась:
  - [ ] бейдж → `•`
  - [ ] 'Navigate to Terminal' → активен, и приводит к правильному терминалу
- [ ] Закрыть терминал → badge исчезает
- [ ] "Test: Multiple Instances": запустить 3 раза → `●3` →
  завершаются по одной
  - [ ] бейдж → `●2` → `●` → `•`
  - [ ] 'Navigate to Terminal' → активен, отражает выбор терминалов с "Test: Multiple Instances" (3)

### Shared terminal

- [ ] Запустить A → `●` у A
- [ ] Запустить B (тот же терминал) → `●` переезжает к B, A становится idle
- [ ] B завершается → `•` у B, A остаётся idle

### Цепочки (dependsOn)

- [ ] Simple: запуск → зависимость получает `●` → завершается → основная получает `●`
- [ ] Parallel: обе зависимости получают `●` одновременно
- [ ] Compound task: сама без badge, зависимости обновляются нормально

### Background

- [ ] Запустить → `●` (не исчезает пока терминал жив)
- [ ] Обновление списка → сохраняет все в.с.
- [ ] Закрыть терминал → badge исчезает

### Специфичные presentation

- [ ] `showReuseMessage: false` — в.с. обновляется корректно
- [ ] `close: true` — терминал закрывается, badge исчезает


## Чек-лист настроек

### display.segmentSeparator (default: пусто)

- [ ] Пусто → все задачи плоским списком
- [ ] `:` → `Test:Hierarchy:Deep` становится `Test/Hierarchy/Deep`
- [ ] Изменение на лету → список перестраивается, в.с. сохраняется

### display.useGroupKind (default: false)

- [ ] false → `group: build` не влияет на структуру
- [ ] true → появляются папки `Build`, `Test`
- [ ] Комбо с `display.segmentSeparator` → группа как верхний уровень

### display.useFolderIcon (default: false)

- [ ] false → промежуточные сегменты без иконки
- [ ] true → иконка папки

### display.tintLabel (default: false) ⚠️ reload

- [ ] false → только иконка цветная
- [ ] true → label тоже цветной

### filtering.showHidden (default: false)

- [ ] false → `hide: true` задачи не видны
- [ ] true → видны с пометкой `hidden`

### validation.duplicateLabels (default: true) ⚠️ reload

- [ ] Две задачи с одинаковым label → диагностика в Problems

### validation.dependencies (default: false) ⚠️ reload

- [ ] `dependsOn: ["несуществующая"]` → диагностика в Problems


## Сценарии сохранения состояния

- [ ] Refresh list → в.с. сохраняется
- [ ] Reload window → ???
- [ ] Удалить задачу из json → сохранить → Ctrl+Z → сохранить → в.с. вернулось
- [ ] Reload extension → все состояния потеряны (ожидаемо)


### Race Condition (хаос-тест)

- [ ] Спамить "Run Task" на `Test: Multiple Instances`:
  - Терминалы открываются/переиспользуются хаотично
  - Badge отражает актуальное количество running инстансов в любой момент
  - Завершения происходят вперемешку с новыми запусками
- [ ] После окончания спама дождаться стабилизации → badge соответствует реальности
- [ ] "Navigate to Terminal" → список содержит ровно те терминалы (и ровно столько), что заняты `Test: Multiple Instances`


## Жизненный цикл и процессы

- [ ] Zombie Child: Запустить → ●. Убить процесс sleep через монитор ресурсов → ● сменяется на •.
- [ ] Empty Trash: Запустить 3 любые задачи → ●. Нажать иконку корзины (Kill All Terminals) в панели терминалов → все бейджи исчезли.

## Сложные зависимости

- [ ] Diamond: Запустить Diamond D. Убедиться, что A не моргает дважды (VS Code дедуплицирует задачи).
- [ ] Chain Reaction: Запустить "Dependency Fail - Part 2". Part 1 показывает ● → ошибка. Part 2 остается idle (не переходит в ●).


### TODO / Мысли

- [ ] Проверить reload window
- [ ] Что если dependsOn ссылается на себя? (циклическая зависимость)
